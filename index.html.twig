{# 1. Extend the master layout we created in Step 1 #}
{% extends 'layout.html.twig' %}

{# 2. Fill the title block #}
{% block title %}Programming Languages List{% endblock %}

{# 3. Fill the content block with the rest of the HTML #}
{% block content %}

    <h1>List of ALL my Languages!!!</h1>

   <div class="container">
        <form class="row g-3">
            <div class="col-auto">
                <input type="text" class="form-control" id="searchBox" placeholder="Start typing keywords...">
            </div>
        </form>
        <p id="results"></p>

    
    </div>

    {# Table using Twig's {% for %} loop #}
    <table class="table table-dark table-striped table-hover">
        <tr class="table-light">
            <th>Lang ID</th>
            <th>Lang Name</th>
            <th>Ratings</th>
            <th>Released Date</th>
            <th></th> 
            <th></th>
        </tr>
        
        {# Loop through the 'languages' array passed from index.php #}
        {% for lang in languages %}
        <tr>
            <td>{{ lang.lang_id }}</td>
            {# Use Twig variable syntax {{ ... }} for output #}
            <td><a href="lang-details.php?id={{ lang.lang_id }}">{{ lang.lang_name }}</a></td>
            <td>{{ lang.rating }}</td>
            <td>{{ lang.released_date }}</td>
            
            {# Action Buttons #}
            <td><a class="btn btn-outline-danger" href="delete-lang.php?id={{ lang.lang_id }}" role="button">Delete</a></td>
            <td><a class="btn btn-outline-warning" href="edit-lang-form.php?id={{ lang.lang_id }}" role="button">Edit</a></td>
        </tr>
        {% endfor %}
    </table>

    <a href="add-lang-form.php" class="btn btn-primary">Add a Lang</a>

    
<script>
    // 1. Define the core AJAX logic function (Globally available)
    function doSearch() {
        // Find elements inside the function to be safe
        const searchBox = document.getElementById("searchBox");
        const resultsArea = document.getElementById("results");
        
        if (!searchBox || !resultsArea) return; 

        // Get the value and remove leading/trailing whitespace
        const keywords = searchBox.value.trim(); 

        // ðŸ›‘ STEP 1: HIDE RESULTS IF SEARCH BOX IS EMPTY ðŸ›‘
        if (keywords.length === 0) {
            resultsArea.innerHTML = ''; // Clear the results area
            return; // **STOP EXECUTION HERE**
        }

        // STEP 2: IF KEYWORDS EXIST, RUN SEARCH
        resultsArea.innerHTML = 'Searching...'; 

        // Use encodeURIComponent for safety, though not strictly required here
        fetch('ajax.php?search=' + encodeURIComponent(keywords)) 
        
        .then(response => response.json())
        
        .then(data => {
            resultsArea.innerHTML = ''; // Clear 'Searching...'
            
            if (data.length > 0) {
                let output = "Found: ";
                data.forEach(lang => {
                    output += `${lang.lang_name} | `; 
                });
                resultsArea.innerHTML = output;
            } else {
                resultsArea.innerHTML = "No languages found matching your query.";
            }
        })
        .catch(error => {
            console.error('AJAX Fetch Error:', error);
            resultsArea.innerHTML = `Error: Failed to fetch data.`;
        });
    }

    // 2. Attach the listener once the DOM is ready (the most reliable method)
    document.addEventListener('DOMContentLoaded', function () {
        const searchBox = document.getElementById("searchBox");
        if (searchBox) {
            // Attach the globally defined function
            searchBox.addEventListener("keyup", doSearch);
        }
    });
</script>

{% endblock %}








